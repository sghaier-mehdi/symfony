{# templates/admin_reclamation/index.html.twig #}
{% extends 'back/base.html.twig' %} {# Or your admin base template path #}

{% block title %}Gestion des Réclamations{% endblock %}

{% block body %}
    <div class="container-fluid mt-4">
        <h1>Toutes les Réclamations</h1>

        {# Display Flash Messages #}
        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert alert-{{ label }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endfor %}

        {# TODO: Add Filter Controls here if desired (DatePicker, CheckBoxes) #}
        {# <div class="mb-3 p-3 border rounded bg-light"> #}
        {#    <h5>Filtres</h5> #}
        {#    ... your filter form or controls ... #}
        {# </div> #}

        {% if reclamations is empty %}
            <div class="alert alert-info" role="alert">
                Aucune réclamation trouvée.
            </div>
        {% else %}
            <table class="table table-striped table-hover table-bordered">
                <thead class="table-dark">
                    <tr>
                        {# <th>ID</th> #} {# ID removed as requested #}
                        <th>Titre</th>
                        <th>Utilisateur</th>
                        <th>Type</th>
                        <th>Date Création</th>
                        <th>Sentiment</th>
                        <th>Urgent</th>
                        <th>Statut Réponse</th>
                        <th style="width: 220px;">Actions</th> {# Wider column for more buttons #}
                    </tr>
                </thead>
                <tbody>
                {% for reclamation in reclamations %}
                    <tr>
                        {# <td>{{ reclamation.id }}</td> #} {# ID removed #}
                        <td>{{ reclamation.titre | e }}</td>
                        <td>{{ reclamation.user ? (reclamation.user.fullName | e) : 'N/A' }} <small class="text-muted"> (ID: {{ reclamation.user ? reclamation.user.id : 'N/A' }})</small></td>
                        <td>{{ reclamation.typeReclamation | e }}</td>
                        <td>{{ reclamation.dateCreation ? reclamation.dateCreation|date('d/m/Y H:i') : '' }}</td>
                        <td>{{ reclamation.sentiment | e }}</td>
                        <td style="{{ reclamation.urgent ? 'color:red; font-weight:bold;' : '' }}">{{ reclamation.urgent ? 'Oui' : 'Non' }}</td>
                        <td>
                            {% if reclamation.reponse %}
                                <span class="badge bg-success">Répondu</span>
                            {% else %}
                                <span class="badge bg-warning text-dark">En attente</span>
                            {% endif %}
                        </td>
                        <td>
                            {# --- Action Buttons --- #}
                            {% if reclamation.reponse and reclamation.reponse.id is not null %}
                                {# Response exists AND has an ID - Show "Voir", "Modifier", and "Supprimer Réponse" buttons #}
                                <a href="{{ path('admin_reclamation_show_response', {'id': reclamation.reponse.id}) }}" class="btn btn-info btn-sm mb-1" title="Voir Réponse"><i class="bi bi-eye-fill"></i> Voir</a>
                                <a href="{{ path('admin_reclamation_respond', {'id': reclamation.id}) }}" class="btn btn-warning btn-sm mb-1" title="Modifier Réponse"><i class="bi bi-pencil-fill"></i> Modifier</a>

                                {# Delete Response Form #}
                                <form method="post" action="{{ path('admin_reclamation_delete_response', {'id': reclamation.reponse.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette réponse?');" style="display: inline-block;">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete_response' ~ reclamation.reponse.id) }}">
                                    <button type="submit" class="btn btn-outline-danger btn-sm mb-1" title="Supprimer Réponse"><i class="bi bi-trash3-fill"></i> Suppr. Rép.</button>
                                </form>
                            {% else %}
                                {# No response - Show "Répondre" button #}
                                <a href="{{ path('admin_reclamation_respond', {'id': reclamation.id}) }}" class="btn btn-primary btn-sm d-block" title="Répondre"><i class="bi bi-chat-left-dots-fill"></i> Répondre</a>
                            {% endif %}

                            {# Delete Reclamation Form - always available #}
                            <form method="post" action="{{ path('admin_reclamation_delete', {'id': reclamation.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer CETTE RÉCLAMATION ENTIÈRE?');" style="display: inline-block;">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ reclamation.id) }}">
                                <button type="submit" class="btn btn-danger btn-sm mt-1" title="Supprimer Réclamation"><i class="bi bi-x-octagon-fill"></i> Suppr. Récl.</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {# Add specific JS for this page if needed #}
    {# Example for Bootstrap tooltips, if you add data-bs-toggle="tooltip" to buttons #}
    {# <script>
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    </script> #}
{% endblock %}